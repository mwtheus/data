# Getting Started: Flask and Docker

The configuration of the container is pretty straightforward in the first steps
of deploying the application. For a simple app, we can have a project that looks
something like this:

```
├── app
│   ├── templates
│   │   └── index.html
│   ├── static
│   │   ├── styles.css
│   │   └── scripts.js
│   ├── views.py
│   └── __init__.py
├── requirements.txt
├── uwsgi.ini
├── main.py
├── start.sh
└── Dockerfile
```

## Snippets


##### requirements.txt

```
Flask==1.0.2
```

##### uwsgi.ini

```ini
[uwsgi]
module = main
callable = app
master = true
touch-reload = /app/uwsgi.ini
```

In the above snippet, we are defining the `module` that Flask will be served 
from - in this case, `main.py`, referenced as `main`. We are also calling `app`,
which is the instance exported by the main application. The `master` option
allows the application to keep running and `touch-reload` allows it to reload
when some file is updated without having to restart the container.

##### main.py

```python
from app import app
```

##### Dockerfile

```
FROM tiangolo/uwsgi-nginx-flask:python3.6-alpine3.7
RUN apk --update add bash nano
ENV STATIC_URL /app/static
ENV STATIC_PATH /app/static
COPY ./requirements.txt ./requirements.txt
RUN pip install -r ./requirements.txt
```

In this case, I will call `docker` from my current directory. The image
[tiangolo/uwsgi-nginx-flask](https://hub.docker.com/r/tiangolo/uwsgi-nginx-flask)
is available at [DockerHub](https://hub.docker.com/). Here, we are defining the
necessary environment variables and installing the Flask version defined in
`requirements.txt`.

##### start.sh

```bash
#!/bin/bash

app="docker.test"
docker build -t ${app} .
docker run -d -p 56733:80 --name=${app} -v $PWD:/app ${app}
```

In this case, the port used will be 56733, that will be mapped to 80 in the
container. You need to make sure that the chosen port is not being used.

The -v states that I want to copy all the file from the current directory to
`/app`. This means that I will be able to import any of the files in the
container, since they will all be in it. That was necessary for my case because
I had a stream of data generated by another script, that I wanted to access from
my Flask app, but I didn't want to change the struture of the project yet.

In case you wanna restart, you can use this command:

```console
$ docker stop docker.test && docker start docker.test
```

Now, inside our app module, we have the default Flask structure.

##### app/__init__.py

```python
from flask import Flask
app = Flask(__name__)
from app import views
```

##### app/views

```python
from flask import render_template

@app.route('/')
def index():
  return render_template('index.html')
```

And there we go... This is really handy and fast when we want to deploy simple
applications.

## References

[How To Build and Deploy a Flask Application Using Docker on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-build-and-deploy-a-flask-application-using-docker-on-ubuntu-18-04)

###### Tue, 23 Feb 2021. 08:32
